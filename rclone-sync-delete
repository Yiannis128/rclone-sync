#!/bin/bash
set -e

# Source common library
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
source "$SCRIPT_DIR/rclone-sync-common.sh"

usage() {
    echo "Usage: $0 <instance-name>"
    echo "Example: $0 documents"
    exit 1
}

if [ $# -ne 1 ]; then
    usage
fi

INSTANCE="$1"

# Load config to find paths for cache cleanup
if ! load_instance_config "$INSTANCE"; then
    exit 1
fi

# Stop and disable service
echo "Stopping service..."
stop_service "$INSTANCE"

# Remove config
echo "Removing config..."
rm -f "$CONFIG_DIR/$INSTANCE.conf"

# Clean up cache files
cleanup_cache_files "$REMOTE_PATH" "$LOCAL_DIR"

echo ""
echo "Instance '$INSTANCE' deleted."
